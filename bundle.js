(()=>{"use strict";function e(e,t,n){const r=e.createShader(t);if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)){const t=e.getShaderInfoLog(r);throw e.deleteShader(r),new Error("Shader compile error: "+t+"\n"+n)}return r}function t(t,n,r,a={},i=null){const o=e(t,t.VERTEX_SHADER,n),f=e(t,t.FRAGMENT_SHADER,r),l=t.createProgram();t.attachShader(l,o),t.attachShader(l,f);for(const[e,n]of Object.entries(a))t.bindAttribLocation(l,n,e);if(i&&t.transformFeedbackVaryings(l,i,t.SEPARATE_ATTRIBS),t.linkProgram(l),!t.getProgramParameter(l,t.LINK_STATUS)){const e=t.getProgramInfoLog(l);throw t.deleteProgram(l),new Error("Program link error: "+e)}return l}function n(e,t,n){const r=e.createTexture();return e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,n,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindTexture(e.TEXTURE_2D,null),r}function r(e,t){const n=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,n),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0);const r=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;if(e.bindFramebuffer(e.FRAMEBUFFER,null),!r)throw new Error("Framebuffer incomplete");return n}const a="attribute vec2 a_pos;\nvarying vec2 v_uv;\nvoid main(){ v_uv = a_pos*0.5 + 0.5; gl_Position = vec4(a_pos,0.0,1.0); }\n",i="precision highp float;\nvarying float v_bright;\nvarying float v_type;\n\nfloat hash(float n){ return fract(sin(n) * 43758.5453123); }\nfloat noise(vec2 p){ return hash(p.x * 12.9898 + p.y * 78.233); }\n\nvoid main(){\n  vec2 p = gl_PointCoord * 2.0 - 1.0;\n  float r = length(p);\n  float density = exp(-2.5 * r * r);\n  float n = noise(p + v_bright);\n  density *= mix(0.7, 1.3, n);\n  float core = mix(0.9, 1.3, v_type);\n  float glow = mix(0.6, 1.0, v_type);\n  vec3 col = vec3(1.0) * (v_bright * core * density);\n  float alpha = density * glow;\n  gl_FragColor = vec4(col, alpha);\n}\n",o={perspective(e,t,n,r,a){const i=1/Math.tan(.5*t),o=1/(r-a);return e[0]=i/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(a+r)*o,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*a*r*o,e[15]=0,e},lookAt(e,t,n,r){let a=t[0]-n[0],i=t[1]-n[1],o=t[2]-n[2],f=1/Math.hypot(a,i,o);a*=f,i*=f,o*=f;let l=r[1]*o-r[2]*i,u=r[2]*a-r[0]*o,s=r[0]*i-r[1]*a;f=1/Math.hypot(l,u,s),l*=f,u*=f,s*=f;let c=i*s-o*u,_=o*l-a*s,d=a*u-i*l;return e[0]=l,e[1]=c,e[2]=a,e[3]=0,e[4]=u,e[5]=_,e[6]=i,e[7]=0,e[8]=s,e[9]=d,e[10]=o,e[11]=0,e[12]=-(l*t[0]+u*t[1]+s*t[2]),e[13]=-(c*t[0]+_*t[1]+d*t[2]),e[14]=-(a*t[0]+i*t[1]+o*t[2]),e[15]=1,e},multiply(e,t,n){const r=t[0],a=t[1],i=t[2],o=t[3],f=t[4],l=t[5],u=t[6],s=t[7],c=t[8],_=t[9],d=t[10],b=t[11],R=t[12],A=t[13],F=t[14],v=t[15],m=n[0],E=n[1],h=n[2],g=n[3],p=n[4],B=n[5],T=n[6],y=n[7],x=n[8],M=n[9],U=n[10],w=n[11],L=n[12],S=n[13],P=n[14],D=n[15];return e[0]=r*m+f*E+c*h+R*g,e[1]=a*m+l*E+_*h+A*g,e[2]=i*m+u*E+d*h+F*g,e[3]=o*m+s*E+b*h+v*g,e[4]=r*p+f*B+c*T+R*y,e[5]=a*p+l*B+_*T+A*y,e[6]=i*p+u*B+d*T+F*y,e[7]=o*p+s*B+b*T+v*y,e[8]=r*x+f*M+c*U+R*w,e[9]=a*x+l*M+_*U+A*w,e[10]=i*x+u*M+d*U+F*w,e[11]=o*x+s*M+b*U+v*w,e[12]=r*L+f*S+c*P+R*D,e[13]=a*L+l*S+_*P+A*D,e[14]=i*L+u*S+d*P+F*D,e[15]=o*L+s*S+b*P+v*D,e}};let f=5e4;const l=1/30,u=20,s=256,c={"Ambient (α+β)":{mix:[{type:"alpha",frac:.3,speed:2.2,life:3.5,size:26,bright:1.05,qScale:1},{type:"beta",frac:.7,speed:7,life:7,size:10,bright:.65,qScale:1}]},"Am-241 (α)":{mix:[{type:"alpha",frac:1,speed:2.1,life:3.8,size:28,bright:1.15,qScale:.8}]},"Po-210 (α)":{mix:[{type:"alpha",frac:1,speed:2,life:3.4,size:28,bright:1.2,qScale:.8}]},"Rn-222 (α)":{mix:[{type:"alpha",frac:1,speed:2,life:3.2,size:26,bright:1.1,qScale:.85}]},"Sr-90 (β−)":{mix:[{type:"beta",frac:1,speed:6.5,life:7.5,size:9,bright:.6,qScale:1.2}]},"Cs-137 (β−)":{mix:[{type:"beta",frac:1,speed:7.5,life:8,size:10,bright:.62,qScale:1.2}]},"Co-60 (β−)":{mix:[{type:"beta",frac:1,speed:5.5,life:6.8,size:9,bright:.6,qScale:1.1}]},"Th-232 chain (α+β)":{mix:[{type:"alpha",frac:.6,speed:2,life:3.5,size:27,bright:1.1,qScale:.85},{type:"beta",frac:.4,speed:6.8,life:7.5,size:10,bright:.62,qScale:1.15}]},"Cosmic Muons (μ)":{cosmic:!0}},_=document.createElement("canvas");document.getElementById("app").appendChild(_);const d=function(e){let t=e.getContext("webgl2",{alpha:!1,antialias:!0,preserveDrawingBuffer:!1});if(t)return t;if(t=e.getContext("webgl",{alpha:!1,antialias:!0,preserveDrawingBuffer:!1})||e.getContext("experimental-webgl",{alpha:!1,antialias:!0,preserveDrawingBuffer:!1}),!t)throw new Error("WebGL not supported");return t}(_),b="undefined"!=typeof WebGL2RenderingContext&&d instanceof WebGL2RenderingContext;b||(f=1e4);const R=t(d,a,"precision highp float;\nvarying vec2 v_uv;\nuniform sampler2D u_tex;\nvoid main(){ gl_FragColor = texture2D(u_tex, v_uv); }\n"),A=t(d,a,"precision highp float;\nvarying vec2 v_uv;\nuniform sampler2D u_prev;\nuniform float u_decay;\nuniform vec2 u_texel;\nvoid main(){\n  vec4 col = texture2D(u_prev, v_uv) * 0.4;\n  col += texture2D(u_prev, v_uv + u_texel * vec2(1.0, 0.0)) * 0.15;\n  col += texture2D(u_prev, v_uv + u_texel * vec2(-1.0, 0.0)) * 0.15;\n  col += texture2D(u_prev, v_uv + u_texel * vec2(0.0, 1.0)) * 0.15;\n  col += texture2D(u_prev, v_uv + u_texel * vec2(0.0, -1.0)) * 0.15;\n  gl_FragColor = vec4(col.rgb * u_decay, 1.0);\n}\n"),F=t(d,"precision highp float;\nattribute vec3 a_pos;\nattribute float a_size;\nattribute float a_brightness;\nattribute float a_type; // 0=beta,1=alpha\nattribute float a_active;\nuniform mat4 u_viewProj;\nvarying float v_bright;\nvarying float v_type;\nvoid main(){\n  v_bright = a_brightness;\n  v_type = a_type;\n  // Cull inactive particles by moving them off-screen and giving them a size\n  // of zero. This allows us to draw a fixed number of vertices every frame\n  // without updating an index buffer.\n  if (a_active < 0.5) {\n    gl_Position = vec4(2.0, 2.0, 2.0, 1.0);\n    gl_PointSize = 0.0;\n    return;\n  }\n  vec4 clip = u_viewProj * vec4(a_pos, 1.0);\n  gl_Position = clip;\n  float size = a_size / max(0.1, clip.w);\n  gl_PointSize = size;\n}\n",i),v=t(d,"precision highp float;\nattribute vec3 a_pos;\nattribute float a_size;\nattribute float a_brightness;\nattribute float a_type;\nattribute float a_active;\nuniform float u_bounds;\nvarying float v_bright;\nvarying float v_type;\nvoid main(){\n  v_bright = a_brightness;\n  v_type = a_type;\n  if (a_active < 0.5) {\n    gl_Position = vec4(2.0, 2.0, 0.0, 1.0);\n    gl_PointSize = 0.0;\n    return;\n  }\n  gl_Position = vec4(a_pos.x/u_bounds, a_pos.z/u_bounds, 0.0, 1.0);\n  gl_PointSize = a_size;\n}\n",i),m=t(d,"attribute vec3 a_pos;\nuniform mat4 u_viewProj;\nvoid main(){ gl_Position = u_viewProj * vec4(a_pos, 1.0); }\n","precision highp float;\nuniform vec3 u_color;\nvoid main(){ gl_FragColor = vec4(u_color, 1.0); }\n");let E=null;b&&(E=t(d,"#version 300 es\nprecision highp float;\n\nin vec4 a_state1; // xyz, life\nin vec4 a_state2; // vx vy vz type\nin vec4 a_state3; // size, bright, active, qScale\n\nuniform float u_dt;\nuniform float u_bounds;\nuniform float u_dragBase;\nuniform float u_jitter;\nuniform float u_B;\n\nout vec4 v_state1;\nout vec4 v_state2;\nout vec4 v_state3;\n\nfloat rand(float seed) {\n  return fract(sin(seed) * 43758.5453123);\n}\n\nvoid main() {\n  vec3 pos = a_state1.xyz;\n  float life = a_state1.w;\n  vec3 vel = a_state2.xyz;\n  float type = a_state2.w;\n  float size = a_state3.x;\n  float bright = a_state3.y;\n  float bActive = a_state3.z;\n  float qScale = a_state3.w;\n\n  if (bActive > 0.5) {\n    float qBase = type > 0.5 ? 0.6 : 1.0;\n    float q = qBase * qScale;\n    vec3 Bvec = vec3(0.0, u_B, 0.0);\n    vec3 acc = q * cross(vel, Bvec);\n    vel += acc * u_dt;\n    float drag = exp(-u_dragBase * u_dt);\n    vel *= drag;\n    float seed = float(gl_VertexID);\n    vel += vec3(\n      (rand(seed * 12.9898) * 2.0 - 1.0) * u_jitter * u_dt,\n      (rand(seed * 78.233) * 2.0 - 1.0) * u_jitter * u_dt * 0.5,\n      (rand(seed * 37.719) * 2.0 - 1.0) * u_jitter * u_dt\n    );\n    pos += vel * u_dt;\n    life -= u_dt;\n    bActive = (life > 0.0 && all(lessThan(abs(pos), vec3(u_bounds)))) ? 1.0 : 0.0;\n    bright = bright * max(0.25, life * 0.15);\n  }\n\n  v_state1 = vec4(pos, life);\n  v_state2 = vec4(vel, type);\n  v_state3 = vec4(size, bright, bActive, qScale);\n}\n","#version 300 es\nprecision highp float;\nvoid main(){}\n",{},["v_state1","v_state2","v_state3"]));const h=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,h),d.bufferData(d.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),d.STATIC_DRAW);const g=d.createBuffer(),p=[[-u,-u,-u],[u,-u,-u],[u,-u,-u],[u,-u,u],[u,-u,u],[-u,-u,u],[-u,-u,u],[-u,-u,-u],[-u,u,-u],[u,u,-u],[u,u,-u],[u,u,u],[u,u,u],[-u,u,u],[-u,u,u],[-u,u,-u],[-u,-u,-u],[-u,u,-u],[u,-u,-u],[u,u,-u],[u,-u,u],[u,u,u],[-u,-u,u],[-u,u,u]].flat();d.bindBuffer(d.ARRAY_BUFFER,g),d.bufferData(d.ARRAY_BUFFER,new Float32Array(p),d.STATIC_DRAW);let B,T,y,x,M,U,w,L,S=2,P=2;function D(){d.disable(d.BLEND),d.bindFramebuffer(d.FRAMEBUFFER,y),d.clearColor(0,0,0,1),d.clear(d.COLOR_BUFFER_BIT),d.bindFramebuffer(d.FRAMEBUFFER,x),d.clearColor(0,0,0,1),d.clear(d.COLOR_BUFFER_BIT),w&&I(),d.bindFramebuffer(d.FRAMEBUFFER,null)}function I(){d.disable(d.BLEND),d.bindFramebuffer(d.FRAMEBUFFER,w),d.clearColor(0,0,0,1),d.clear(d.COLOR_BUFFER_BIT),d.bindFramebuffer(d.FRAMEBUFFER,L),d.clearColor(0,0,0,1),d.clear(d.COLOR_BUFFER_BIT),d.bindFramebuffer(d.FRAMEBUFFER,null)}function C(){const e=Math.min(2,window.devicePixelRatio||1),t=Math.max(2,Math.floor(window.innerWidth*e)),a=Math.max(2,Math.floor(window.innerHeight*e));t===S&&a===P||(S=t,P=a,_.width=t,_.height=a,_.style.width="100%",_.style.height="100%",d.viewport(0,0,t,a),function(e,t){B&&d.deleteTexture(B),T&&d.deleteTexture(T),y&&d.deleteFramebuffer(y),x&&d.deleteFramebuffer(x),B=n(d,e,t),T=n(d,e,t),y=r(d,B),x=r(d,T),D()}(t,a))}window.addEventListener("resize",C),C(),M&&d.deleteTexture(M),U&&d.deleteTexture(U),w&&d.deleteFramebuffer(w),L&&d.deleteFramebuffer(L),M=n(d,s,s),U=n(d,s,s),w=r(d,M),L=r(d,U),I();let Y=.6,O=.2,N=14,z=!1,X=0,q=0;function V(){const e=[N*Math.cos(O)*Math.cos(Y),N*Math.sin(O),N*Math.cos(O)*Math.sin(Y)],t=new Float32Array(16),n=new Float32Array(16),r=new Float32Array(16);o.lookAt(t,e,[0,0,0],[0,1,0]);const a=60*Math.PI/180;return o.perspective(n,a,S/P,.1,400),o.multiply(r,n,t),r}_.addEventListener("mousedown",e=>{z=!0,X=e.clientX,q=e.clientY}),window.addEventListener("mouseup",()=>z=!1),window.addEventListener("mousemove",e=>{if(!z)return;const t=(e.clientX-X)/window.innerWidth,n=(e.clientY-q)/window.innerHeight;Y+=3*t,O=Math.max(-1.2,Math.min(1.2,O+3*n)),X=e.clientX,q=e.clientY}),window.addEventListener("wheel",e=>{N=Math.max(4,Math.min(40,N+Math.sign(e.deltaY)))});let G,j,k,W,H=null,K=0;if(b){const e=[d.createBuffer(),d.createBuffer(),d.createBuffer()],t=[d.createBuffer(),d.createBuffer(),d.createBuffer()];for(const n of[...e,...t])d.bindBuffer(d.ARRAY_BUFFER,n),d.bufferData(d.ARRAY_BUFFER,new Float32Array(4*f),d.DYNAMIC_COPY);G=e,H=t}else{G=[d.createBuffer(),d.createBuffer(),d.createBuffer()],j=new Float32Array(4*f),k=new Float32Array(4*f),W=new Float32Array(4*f);const e=[j,k,W];for(let t=0;t<3;t++)d.bindBuffer(d.ARRAY_BUFFER,G[t]),d.bufferData(d.ARRAY_BUFFER,e[t],d.DYNAMIC_DRAW)}function Z(e){const t=ne.value,n=c[t]||c["Ambient (α+β)"];if(n.cosmic){const e=18,t=(2*Math.random()-1)*e,n=(2*Math.random()-1)*e,r=22,a=[.1*Math.random()-.05,-1,.1*Math.random()-.05],i=30,o=50;return void J(t,r,n,a[0]*i,a[1]*i,a[2]*i,o,0,8,.5,.05)}const r=function(e){const t=Math.random();let n=0;for(const r of e)if(n+=r.frac,t<=n)return r;return e[e.length-1]}(n.mix),a=function(){const e=2*Math.random()-1,t=Math.random()*Math.PI*2,n=Math.sqrt(Math.max(0,1-e*e));return[n*Math.cos(t),n*Math.sin(t),e]}(),i=r.speed*(.85+.3*Math.random()),o=r.life*(.9+.3*Math.random()),f="alpha"===r.type?1:0;J(e[0],e[1],e[2],a[0]*i,a[1]*i,a[2]*i,o,f,r.size,r.bright,r.qScale)}function J(e,t,n,r,a,i,o,l,u,s,c){const _=K;if(K=(K+1)%f,b)d.bindBuffer(d.ARRAY_BUFFER,G[0]),d.bufferSubData(d.ARRAY_BUFFER,16*_,new Float32Array([e,t,n,o])),d.bindBuffer(d.ARRAY_BUFFER,G[1]),d.bufferSubData(d.ARRAY_BUFFER,16*_,new Float32Array([r,a,i,l])),d.bindBuffer(d.ARRAY_BUFFER,G[2]),d.bufferSubData(d.ARRAY_BUFFER,16*_,new Float32Array([u,s,1,c||1]));else{const f=4*_;j.set([e,t,n,o],f),k.set([r,a,i,l],f),W.set([u,s,1,c||1],f),d.bindBuffer(d.ARRAY_BUFFER,G[0]),d.bufferSubData(d.ARRAY_BUFFER,16*_,j.subarray(f,f+4)),d.bindBuffer(d.ARRAY_BUFFER,G[1]),d.bufferSubData(d.ARRAY_BUFFER,16*_,k.subarray(f,f+4)),d.bindBuffer(d.ARRAY_BUFFER,G[2]),d.bufferSubData(d.ARRAY_BUFFER,16*_,W.subarray(f,f+4))}}_.addEventListener("click",e=>{Z(function(e,t){const n=Y,r=O,a=N,i=[a*Math.cos(r)*Math.cos(n),a*Math.sin(r),a*Math.cos(r)*Math.sin(n)],o=e/window.innerWidth*2-1,f=1-t/window.innerHeight*2,l=[-i[0],-i[1],-i[2]],u=Math.hypot(l[0],l[1],l[2]);l[0]/=u,l[1]/=u,l[2]/=u;let s=[l[2],0,-l[0]],c=Math.hypot(s[0],s[1],s[2]);s=[s[0]/c,s[1]/c,s[2]/c];let _=[s[1]*l[2]-s[2]*l[1],s[2]*l[0]-s[0]*l[2],s[0]*l[1]-s[1]*l[0]];const d=60*Math.PI/180,b=window.innerWidth/window.innerHeight,R=Math.tan(d/2),A=[l[0]+o*b*R*s[0]+f*R*_[0],l[1]+o*b*R*s[1]+f*R*_[1],l[2]+o*b*R*s[2]+f*R*_[2]],F=-i[1]/(A[1]||1e-6);return[i[0]+A[0]*F,0,i[2]+A[2]*F]}(e.clientX,e.clientY))});const Q=document.getElementById("bRange"),$=document.getElementById("vRange"),ee=document.getElementById("rRange"),te=document.getElementById("trailRange"),ne=document.getElementById("isoSelect"),re=document.getElementById("toggleBtn"),ae=document.getElementById("clearBtn"),ie=document.getElementById("densityBtn"),oe={};for(const e of ne.options)oe[e.value]=parseFloat(ee.value);oe["Cosmic Muons (μ)"]=5,ne.addEventListener("change",()=>{ee.value=oe[ne.value]||0}),ee.addEventListener("input",()=>{oe[ne.value]=parseFloat(ee.value)});let fe=!1;re.addEventListener("click",()=>{fe=!fe,re.textContent=fe?"Resume":"Pause"}),ae.addEventListener("click",()=>{D()}),ie.addEventListener("click",()=>{ue=!ue,ie.textContent=ue?"Density: On":"Density: Off",ue&&I()});let le,ue=!1;function se(e){const t=d.getAttribLocation(e,"a_pos");d.bindBuffer(d.ARRAY_BUFFER,h),d.enableVertexAttribArray(t),d.vertexAttribPointer(t,2,d.FLOAT,!1,0,0)}function ce(e,t){const n=d.getAttribLocation(e,"a_pos"),r=d.getAttribLocation(e,"a_size"),a=d.getAttribLocation(e,"a_brightness"),i=d.getAttribLocation(e,"a_type"),o=d.getAttribLocation(e,"a_active");d.bindBuffer(d.ARRAY_BUFFER,t[0]),d.enableVertexAttribArray(n),d.vertexAttribPointer(n,3,d.FLOAT,!1,16,0),d.bindBuffer(d.ARRAY_BUFFER,t[1]),d.enableVertexAttribArray(i),d.vertexAttribPointer(i,1,d.FLOAT,!1,16,12),d.bindBuffer(d.ARRAY_BUFFER,t[2]),d.enableVertexAttribArray(r),d.vertexAttribPointer(r,1,d.FLOAT,!1,16,0),d.enableVertexAttribArray(a),d.vertexAttribPointer(a,1,d.FLOAT,!1,16,4),d.enableVertexAttribArray(o),d.vertexAttribPointer(o,1,d.FLOAT,!1,16,8)}le=b?function(e){const t=parseFloat(Q.value),n=parseFloat($.value),r=parseFloat(ee.value)*e;let a=Math.floor(r);Math.random()<r-a&&a++;const i=ne.value;for(let e=0;e<a;e++)if("Cosmic Muons (μ)"===i)Z(null);else{const e=u-2;Z([(2*Math.random()-1)*e,(2*Math.random()-1)*e,(2*Math.random()-1)*e])}const o=.3+.8*n,l=.3+1.2*n;d.useProgram(E);const s=d.getAttribLocation(E,"a_state1"),c=d.getAttribLocation(E,"a_state2"),_=d.getAttribLocation(E,"a_state3");d.bindBuffer(d.ARRAY_BUFFER,G[0]),d.enableVertexAttribArray(s),d.vertexAttribPointer(s,4,d.FLOAT,!1,0,0),d.bindBuffer(d.ARRAY_BUFFER,G[1]),d.enableVertexAttribArray(c),d.vertexAttribPointer(c,4,d.FLOAT,!1,0,0),d.bindBuffer(d.ARRAY_BUFFER,G[2]),d.enableVertexAttribArray(_),d.vertexAttribPointer(_,4,d.FLOAT,!1,0,0),d.bindBufferBase(d.TRANSFORM_FEEDBACK_BUFFER,0,H[0]),d.bindBufferBase(d.TRANSFORM_FEEDBACK_BUFFER,1,H[1]),d.bindBufferBase(d.TRANSFORM_FEEDBACK_BUFFER,2,H[2]),d.uniform1f(d.getUniformLocation(E,"u_dt"),e),d.uniform1f(d.getUniformLocation(E,"u_bounds"),u),d.uniform1f(d.getUniformLocation(E,"u_dragBase"),o),d.uniform1f(d.getUniformLocation(E,"u_jitter"),l),d.uniform1f(d.getUniformLocation(E,"u_B"),t),d.enable(d.RASTERIZER_DISCARD),d.beginTransformFeedback(d.POINTS),d.drawArrays(d.POINTS,0,f),d.endTransformFeedback(),d.disable(d.RASTERIZER_DISCARD),d.bindBufferBase(d.TRANSFORM_FEEDBACK_BUFFER,0,null),d.bindBufferBase(d.TRANSFORM_FEEDBACK_BUFFER,1,null),d.bindBufferBase(d.TRANSFORM_FEEDBACK_BUFFER,2,null),d.disableVertexAttribArray(s),d.disableVertexAttribArray(c),d.disableVertexAttribArray(_);let b=G;G=H,H=b}:function(e){const t=parseFloat(Q.value),n=parseFloat($.value),r=parseFloat(ee.value)*e;let a=Math.floor(r);Math.random()<r-a&&a++;const i=ne.value;for(let e=0;e<a;e++)if("Cosmic Muons (μ)"===i)Z(null);else{const e=u-2;Z([(2*Math.random()-1)*e,(2*Math.random()-1)*e,(2*Math.random()-1)*e])}const o=.3+.8*n,l=.3+1.2*n;function s(e){const t=43758.5453123*Math.sin(e);return t-Math.floor(t)}for(let n=0;n<f;n++){const r=4*n;let a=j[r],i=j[r+1],f=j[r+2],c=j[r+3],_=k[r],d=k[r+1],b=k[r+2],R=k[r+3],A=W[r],F=W[r+1],v=W[r+2],m=W[r+3];if(v>.5){const r=(R>.5?.6:1)*m,A=r*(-_*t);_+=r*(b*t)*e,b+=A*e;const E=Math.exp(-o*e);_*=E,d*=E,b*=E;const h=n;_+=(2*s(12.9898*h)-1)*l*e,d+=(2*s(78.233*h)-1)*l*e*.5,b+=(2*s(37.719*h)-1)*l*e,a+=_*e,i+=d*e,f+=b*e,c-=e,v=c>0&&Math.abs(a)<u&&Math.abs(i)<u&&Math.abs(f)<u?1:0,F*=Math.max(.25,.15*c)}j[r]=a,j[r+1]=i,j[r+2]=f,j[r+3]=c,k[r]=_,k[r+1]=d,k[r+2]=b,k[r+3]=R,W[r]=A,W[r+1]=F,W[r+2]=v,W[r+3]=m}d.bindBuffer(d.ARRAY_BUFFER,G[0]),d.bufferSubData(d.ARRAY_BUFFER,0,j),d.bindBuffer(d.ARRAY_BUFFER,G[1]),d.bufferSubData(d.ARRAY_BUFFER,0,k),d.bindBuffer(d.ARRAY_BUFFER,G[2]),d.bufferSubData(d.ARRAY_BUFFER,0,W)};let _e=performance.now();requestAnimationFrame(function e(t){const n=Math.min(l,(t-_e)/1e3);_e=t,fe||le(n);const r=parseFloat(te.value);!function(e,t,n){d.bindFramebuffer(d.FRAMEBUFFER,e),d.viewport(0,0,S,P),d.disable(d.BLEND),d.useProgram(A),se(A),d.activeTexture(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,t),d.uniform1i(d.getUniformLocation(A,"u_prev"),0),d.uniform1f(d.getUniformLocation(A,"u_decay"),n),d.uniform2f(d.getUniformLocation(A,"u_texel"),1/S,1/P),d.drawArrays(d.TRIANGLE_STRIP,0,4),d.enable(d.BLEND),d.blendFunc(d.SRC_ALPHA,d.ONE),d.useProgram(F),ce(F,G),d.uniformMatrix4fv(d.getUniformLocation(F,"u_viewProj"),!1,V()),d.drawArrays(d.POINTS,0,f),d.bindFramebuffer(d.FRAMEBUFFER,null)}(y,T,r),ue&&function(e,t,n){d.bindFramebuffer(d.FRAMEBUFFER,e),d.viewport(0,0,s,s),d.disable(d.BLEND),d.useProgram(A),se(A),d.activeTexture(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,t),d.uniform1i(d.getUniformLocation(A,"u_prev"),0),d.uniform1f(d.getUniformLocation(A,"u_decay"),n),d.uniform2f(d.getUniformLocation(A,"u_texel"),.00390625,.00390625),d.drawArrays(d.TRIANGLE_STRIP,0,4),d.enable(d.BLEND),d.blendFunc(d.SRC_ALPHA,d.ONE),d.useProgram(v),ce(v,G),d.uniform1f(d.getUniformLocation(v,"u_bounds"),u),d.drawArrays(d.POINTS,0,f),d.bindFramebuffer(d.FRAMEBUFFER,null)}(w,U,r),function(e){d.disable(d.DEPTH_TEST),d.viewport(0,0,S,P),d.disable(d.BLEND),d.useProgram(R),se(R),d.activeTexture(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,e),d.uniform1i(d.getUniformLocation(R,"u_tex"),0),d.drawArrays(d.TRIANGLE_STRIP,0,4),d.useProgram(m);const t=d.getAttribLocation(m,"a_pos");if(d.bindBuffer(d.ARRAY_BUFFER,g),d.enableVertexAttribArray(t),d.vertexAttribPointer(t,3,d.FLOAT,!1,0,0),d.uniformMatrix4fv(d.getUniformLocation(m,"u_viewProj"),!1,V()),d.uniform3f(d.getUniformLocation(m,"u_color"),.9,.95,1),d.drawArrays(d.LINES,0,24),ue){const e=Math.floor(.3*Math.min(S,P));d.viewport(10,10,e,e),d.disable(d.BLEND),d.useProgram(R),se(R),d.activeTexture(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,M),d.uniform1i(d.getUniformLocation(R,"u_tex"),0),d.drawArrays(d.TRIANGLE_STRIP,0,4),d.viewport(0,0,S,P)}}(B);let a=B;B=T,T=a;let i=y;y=x,x=i,ue&&(a=M,M=U,U=a,i=w,w=L,L=i),requestAnimationFrame(e)});for(let e=0;e<48;e++){const e=u-2;Z([(2*Math.random()-1)*e,(2*Math.random()-1)*e,(2*Math.random()-1)*e])}D()})();